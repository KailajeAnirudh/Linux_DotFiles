/*******************************************************
* Copyright (C) 2018-2024 WP Interactive Media, Inc. - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
*******************************************************/
(()=>{var t={5640:()=>{!function(t,n,e){"use strict";if(t.MutationObserver&&"undefined"!=typeof HTMLElement){var i,o=0,r=(i=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector,{matchesSelector:function(t,n){return t instanceof HTMLElement&&i.call(t,n)},addMethod:function(t,n,e){var i=t[n];t[n]=function(){return e.length==arguments.length?e.apply(this,arguments):"function"==typeof i?i.apply(this,arguments):void 0}},callCallbacks:function(t,n){n&&n.options.onceOnly&&1==n.firedElems.length&&(t=[t[0]]);for(var e,i=0;e=t[i];i++)e&&e.callback&&e.callback.call(e.elem,e.elem);n&&n.options.onceOnly&&1==n.firedElems.length&&n.me.unbindEventWithSelectorAndCallback.call(n.target,n.selector,n.callback)},checkChildNodesRecursively:function(t,n,e,i){for(var o,s=0;o=t[s];s++)e(o,n,i)&&i.push({callback:n.callback,elem:o}),o.childNodes.length>0&&r.checkChildNodesRecursively(o.childNodes,n,e,i)},mergeArrays:function(t,n){var e,i={};for(e in t)t.hasOwnProperty(e)&&(i[e]=t[e]);for(e in n)n.hasOwnProperty(e)&&(i[e]=n[e]);return i},toElementsArray:function(n){return void 0===n||"number"==typeof n.length&&n!==t||(n=[n]),n}}),s=function(){var t=function(){this.t=[],this.i=null,this.o=null};return t.prototype.addEvent=function(t,n,e,i){var o={target:t,selector:n,options:e,callback:i,firedElems:[]};return this.i&&this.i(o),this.t.push(o),o},t.prototype.removeEvent=function(t){for(var n,e=this.t.length-1;n=this.t[e];e--)if(t(n)){this.o&&this.o(n);var i=this.t.splice(e,1);i&&i.length&&(i[0].callback=null)}},t.prototype.beforeAdding=function(t){this.i=t},t.prototype.beforeRemoving=function(t){this.o=t},t}(),c=function(n,i){var o=new s,c=this,u={fireOnAttributesModification:!1};return o.beforeAdding((function(e){var o,r=e.target;r!==t.document&&r!==t||(r=document.getElementsByTagName("html")[0]),o=new MutationObserver((function(t){i.call(this,t,e)}));var s=n(e.options);o.observe(r,s),e.observer=o,e.me=c})),o.beforeRemoving((function(t){t.observer.disconnect()})),this.bindEvent=function(t,n,e){n=r.mergeArrays(u,n);for(var i=r.toElementsArray(this),s=0;s<i.length;s++)o.addEvent(i[s],t,n,e)},this.unbindEvent=function(){var t=r.toElementsArray(this);o.removeEvent((function(n){for(var i=0;i<t.length;i++)if(this===e||n.target===t[i])return!0;return!1}))},this.unbindEventWithSelectorOrCallback=function(t){var n,i=r.toElementsArray(this),s=t;n="function"==typeof t?function(t){for(var n=0;n<i.length;n++)if((this===e||t.target===i[n])&&t.callback===s)return!0;return!1}:function(n){for(var o=0;o<i.length;o++)if((this===e||n.target===i[o])&&n.selector===t)return!0;return!1},o.removeEvent(n)},this.unbindEventWithSelectorAndCallback=function(t,n){var i=r.toElementsArray(this);o.removeEvent((function(o){for(var r=0;r<i.length;r++)if((this===e||o.target===i[r])&&o.selector===t&&o.callback===n)return!0;return!1}))},this},u=new function(){var t={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};function n(t,n,i){return!(!r.matchesSelector(t,n.selector)||(t.u===e&&(t.u=o++),-1!=n.firedElems.indexOf(t.u)))&&(n.firedElems.push(t.u),!0)}var i=(u=new c((function(t){var n={attributes:!1,childList:!0,subtree:!0};return t.fireOnAttributesModification&&(n.attributes=!0),n}),(function(t,e){t.forEach((function(t){var i=t.addedNodes,o=t.target,s=[];null!==i&&i.length>0?r.checkChildNodesRecursively(i,e,n,s):"attributes"===t.type&&n(o,e,s)&&s.push({callback:e.callback,elem:o}),r.callCallbacks(s,e)}))}))).bindEvent;return u.bindEvent=function(n,e,o){void 0===o?(o=e,e=t):e=r.mergeArrays(t,e);var s=r.toElementsArray(this);if(e.existing){for(var c=[],u=0;u<s.length;u++)for(var a=s[u].querySelectorAll(n),l=0;l<a.length;l++)c.push({callback:o,elem:a[l]});if(e.onceOnly&&c.length)return o.call(c[0].elem,c[0].elem);setTimeout(r.callCallbacks,1,c)}i.call(this,n,e,o)},u},a=new function(){var t={};function n(t,n){return r.matchesSelector(t,n.selector)}var e=(a=new c((function(){return{childList:!0,subtree:!0}}),(function(t,e){t.forEach((function(t){var i=t.removedNodes,o=[];null!==i&&i.length>0&&r.checkChildNodesRecursively(i,e,n,o),r.callCallbacks(o,e)}))}))).bindEvent;return a.bindEvent=function(n,i,o){void 0===o?(o=i,i=t):i=r.mergeArrays(t,i),e.call(this,n,i,o)},a};n&&h(n.fn),h(HTMLElement.prototype),h(NodeList.prototype),h(HTMLCollection.prototype),h(HTMLDocument.prototype),h(Window.prototype);var l={};return f(u,l,"unbindAllArrive"),f(a,l,"unbindAllLeave"),l}function f(t,n,e){r.addMethod(n,e,t.unbindEvent),r.addMethod(n,e,t.unbindEventWithSelectorOrCallback),r.addMethod(n,e,t.unbindEventWithSelectorAndCallback)}function h(t){t.arrive=u.bindEvent,f(u,t,"unbindArrive"),t.leave=a.bindEvent,f(a,t,"unbindLeave")}}(window,"undefined"==typeof jQuery?null:jQuery,void 0)}},n={};function e(i){var o=n[i];if(void 0!==o)return o.exports;var r=n[i]={exports:{}};return t[i](r,r.exports,e),r.exports}(()=>{"use strict";const t=chrome.runtime.id,n=["crunchyroll","funimation","paramount","peacock","hotstar","starplus","espn","appletv","jiocinema","mubi","stan","crave","sling","philo","fubo","viki"],i="Service_Background",o="Content_Script",r="Failed to read chrome storage. Please refresh the page and try again";var s=function(t,n,e,i){return new(e||(e=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function c(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,c)}u((i=i.apply(t,n||[])).next())}))};const c=new class{getItemsAsync(t){return s(this,void 0,void 0,(function*(){return new Promise(((n,e)=>{chrome.storage.local.get(t,(t=>{chrome.runtime.lastError?(console.log(chrome.runtime.lastError),e(new Error(r))):n(t)}))}))}))}getStorageUse(){return s(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{chrome.storage.local.getBytesInUse(null,(e=>{chrome.runtime.lastError?(console.log(chrome.runtime.lastError),n(new Error(r))):t(e)}))}))}))}getAllItemsAsync(){return s(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{chrome.storage.local.get(null,(e=>{chrome.runtime.lastError?(console.log(chrome.runtime.lastError),n(new Error(r))):t(e)}))}))}))}};Object.freeze(c);const u=c;var a=function(t,n,e,i){return new(e||(e=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function c(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,c)}u((i=i.apply(t,n||[])).next())}))};const l=new class{setItemsAsync(t){return a(this,void 0,void 0,(function*(){return new Promise(((n,e)=>{chrome.storage.local.set(t,(()=>{chrome.runtime.lastError?e(new Error("Failed to write to chrome storage. Please refresh the page and try again")):n()}))}))}))}};Object.freeze(l);const f=l;var h=console.log.bind(window.console),d=function(t,n,e,i){return new(e||(e=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function c(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,c)}u((i=i.apply(t,n||[])).next())}))};const v=new class{addListener(t){chrome.runtime.onMessage.addListener(t),chrome.runtime.onMessage.addListener(t)}removeListener(t){chrome.runtime.onMessage.removeListener(t)}sendMessageToTabAsync(t,n,e=2e4){return d(this,void 0,void 0,(function*(){return new Promise(((i,o)=>{const r=setTimeout((()=>{console.log("send timeout"),o("Message Timeout")}),e);try{chrome.tabs.sendMessage(n,t,(n=>{chrome.runtime.lastError&&h(chrome.runtime.lastError.message+JSON.stringify(t)),clearTimeout(r),i(n)}))}catch(t){clearTimeout(r),o(t)}}))}))}l(n,e){return d(this,void 0,void 0,(function*(){return new Promise(((i,o)=>{let r=null;e&&(r=setTimeout((()=>{o({error:"Send Message Timeout"})}),e));try{chrome.runtime.sendMessage(t,n,(t=>{chrome.runtime.lastError&&console.log(chrome.runtime.lastError.message+JSON.stringify(n)),r&&clearTimeout(r),i(t)}))}catch(t){r&&clearTimeout(r),o(t)}}))}))}};class m{constructor(t,n,e){this.sender=t,this.target=n,this.type=e}}class w extends m{constructor(t,n,e){super(t,n,e),this.type=e}}var g;!function(t){t.JOIN_SESSION="joinSession",t.ACCEPT_DROPIN="acceptDropin",t.SET_STATUS_TYPE="setStatusType",t.GET_STATUS_TYPE="getStatusType",t.GET_VIDEO_DATA="getVideoData",t.LOAD_SESSION="loadSession",t.NO_SESSION_DATA="noSessionData",t.ON_NOTIF="onNotif",t.FORWARD_TO_SIDEBAR="forwardToSidebar",t.TEARDOWN="teardown",t.ON_VIDEO_UPDATE="onVideoUpdate",t.SOCKET_LOST_CONNECTION="socketLostConnection",t.REBOOT="socketReconnect",t.LOG_EVENT="logEvent",t.LOG_EXPERIMENT="logExperiment",t.STAY_ALIVE="stayAlive",t.LOAD_CHAT_WINDOW="loadChatWindow",t.RESET_CHAT_WINDOW="resetChatWindow",t.HIDE_CHAT_WINDOW="hideChatWindow",t.SET_USER_PRESENCE="setUserPresence",t.TOGGLE_OPEN_PARTY="toggleOpenParty",t.GET_ACTIVE_PARTY="getActiveParty",t.GET_TAB_ID="getTabId",t.SET_ACTIVE_PARTY="setActiveParty",t.FULLSCREEN_WINDOW="fullscreenWindow",t.MAX_WINDOW="maxWindow",t.GET_EXPERIMENT_FLAG="getExpFlag",t.USER_LIST="userList",t.USER_AUTHENTICATED="userAuthenticated",t.BLOCK_CSP="blockCSP",t.REDIRECT_DATA_SET="redirectDataSet",t.LOAD_NETFLIX_DATA="loadNetflixData"}(g||(g={}));class p extends w{constructor(t,n,e){super(t,n,g.LOG_EVENT),this.data=e,this.sender=t,this.target=n}}var y,S;!function(t){t.REGISTER="register",t.PARTY_START="party_start",t.PARTY_JOIN="party_join",t.PARTY_END="party_end",t.PARTY_SHARE="party_share"}(y||(y={})),function(t){t.NETFLIX="Netflix",t.HULU="Hulu",t.DISNEY_PLUS="Disney",t.DISNEY_PLUS_MENA="DisneyMena",t.HBO_MAX="HBOMax",t.MAX="Max",t.YOUTUBE="Youtube",t.YOUTUBE_TV="YoutubeTV",t.AMAZON="Amazon",t.CRUNCHYROLL="Crunchyroll",t.ESPN="ESPN+",t.PARAMOUNT="Paramount+",t.FUNIMATION="Funimation",t.HOTSTAR="Hotstar",t.PEACOCK="peacock",t.STAR_PLUS="Starplus",t.PLUTO_TV="PlutoTV",t.APPLE_TV="AppleTV",t.JIO_CINEMA="JioCinema",t.TUBI_TV="TubiTV",t.MUBI="Mubi",t.STAN="Stan",t.CRAVE="Crave",t.SLING="slingtv",t.FUBO="fubo",t.PHILO="philo",t.VIKI="viki",t.SPOTIFY="spotify",t.NATIVE_VIKI="native_party_Viki"}(S||(S={}));class b{constructor(){this.h=this.v.bind(this),this.m=[],this.g()}addMessageListener(t){this.m.push(t)}removeMessageListener(t){this.m=this.m.filter((t=>{}))}g(){v.addListener(this.h)}teardown(){this.m=[],v.removeListener(this.h)}v(t,n,e){if(!this.p(t))return!1;return!!this.S(t,n,e)||(e({}),!1)}p(t){return t.target===o}S(t,n,e){let i=!1;return this.m.forEach((o=>{o.onMessage(t,n,e)&&(i=!0)})),i}}var T;e(5640);!function(t){t.CREATE_SESSION="createSession",t.RE_INJECT="reInject",t.GET_INIT_DATA="getInitData",t.GET_INIT_USER_SETTINGS="getInitUserSettings",t.IS_CONTENT_SCRIPT_READY="isContentScriptReady",t.SET_CHAT_VISIBLE="setChatVisible",t.DISCONNECT="teardown",t.CLOSE_POPUP="closePopup",t.GET_SCHEDULED_EVENTS="getScheduledEvents",t.GET_RECENT_SCHEDULED_EVENTS="getRecentScheduledEvents",t.GOOGLE_SIGN_IN="googleSignIn",t.EMAIL_SIGN_IN="emailSignIn",t.FORGOT_PASSWORD="forgotPassword",t.EMAIL_SIGN_UP="emailSignUp",t.ON_GOOGLE_SIGN_IN="OnGoogleSignIn",t.CREATE_SCHEDULED_EVENT="createScheduledEvent",t.DELETE_SCHEDULED_EVENT="deleteScheduledEvent",t.SET_USER_STATUS="SET_USER_STATUS",t.SIGN_IN_CREATE="SIGN_IN_CREATE",t.REDIRECT_DATA_SET="redirectDataSet"}(T||(T={}));class M extends m{constructor(t,n,e){super(t,n,e),this.type=e}}class L extends M{constructor(t,n){super(t,n,T.GET_INIT_USER_SETTINGS)}}var P=function(t,n,e,i){return new(e||(e=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function c(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,c)}u((i=i.apply(t,n||[])).next())}))};class _ extends class{constructor(t,n){this.h=new b,this.h.addMessageListener(this),this.serviceName=t,this.colloquialServiceName=n,this.T(),this.M(),this.L()}isLoggingIn(){return!1}M(){return P(this,void 0,void 0,(function*(){const t=yield v.l(new L("Popup",i));n.includes(this.serviceName)&&!(null==t?void 0:t.has_premium)||this.P()}))}P(){!function(t){const n=document.createElement("script");n.setAttribute("tpInjected",""),n.src=t,(document.head||document.documentElement).appendChild(n),n.remove()}(chrome.extension.getURL(`browse_scripts/${this.serviceName}/${this.serviceName}_browse_injected_bundled.js`))}T(){chrome.runtime.connect().onMessage.addListener((()=>{console.log("Ping received")}))}L(){return P(this,void 0,void 0,(function*(){}))}onMessage(t,n,e){return!0}}{constructor(){super("netflix",S.NETFLIX)}isLoggingIn(){if(window.location.href.includes("/login"))return!0;const t=document.querySelector("button[data-uia='homepage-link-button']");if("JOIN NOW"===(null==t?void 0:t.textContent))return!0;const n=document.querySelector("a[data-uia='header-login-link']");return"Sign In"===(null==n?void 0:n.textContent)}}var E,A=function(t,n,e,i){return new(e||(e=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function c(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,c)}u((i=i.apply(t,n||[])).next())}))};if(!(window.teleparty&&(null===(E=window.teleparty)||void 0===E?void 0:E.browseScriptInjected)||window!==top)){window.teleparty||(window.teleparty={}),window.teleparty.browseScriptInjected=!0,new _;{const t=()=>A(void 0,void 0,void 0,(function*(){const t=(yield u.getItemsAsync(["NDL"])).NDL;(null==t||Date.now()-t>121e7)&&window.postMessage({type:"tpLoadNetflixData",lastFetch:t},"*")}));window.addEventListener("message",(n=>{if("tpNetflixBrowseReady"===n.data.type&&t(),"tpSetNetflixData"===n.data.type){const t=n.data.data,e=t.deviceList,r=[];e.forEach((t=>{const n=new Date(t.lastWatched).getTime();r.push(Object.assign(Object.assign({},t),{lastWatchedTimeStamp:n}))}));const s=new Map,c=new Set;t.watchHistoryList.forEach((t=>{t.watchHistory.forEach((t=>{let n=-1,e=!1;for(let i=0;i<r.length;i++){const o=r[i];Math.abs(t.date-o.lastWatchedTimeStamp)<6e4&&(-1===n?n=i:e=!0)}if(-1!==n&&!e){const e=r[n].deviceDescription;s.has(t.deviceType)&&s.get(t.deviceType)!==e?(c.add(t.deviceType),s.delete(t.deviceType)):c.has(t.deviceType)||s.set(t.deviceType,r[n].deviceDescription)}}))}));const u={name:"netflix_device_list",data:{device_json:e}};v.l(new p(o,i,u));const a=t.watchHistoryList;let l=0;a.forEach((t=>{t.watchHistory.forEach((t=>{t.deviceDescription=s.get(t.deviceType)})),l=Math.max(l,t.watchHistory.length)}));const h=new w(o,i,g.LOAD_NETFLIX_DATA);h.data=a,v.l(h),f.setItemsAsync({NDL:Date.now()})}}))}}})()})();